services:
  ctf-dev:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ctf-dev

    # Host net is useful for CTF tooling and local service access.
    network_mode: host

    # Many security tools require elevated capabilities.
    privileged: true

    working_dir: /workspace

    # Bind-mount your full project for live editing.
    volumes:
      - ./:/workspace
      - ./logs:/workspace/logs

      # Optional: if your agent will orchestrate sibling containers.
      # - /var/run/docker.sock:/var/run/docker.sock

    # Load local .env (GITHUB_TOKEN, API keys, model, etc.).
    env_file:
      - ./.env

    # Interactive dev shell style container.
    stdin_open: true
    tty: true

    restart: unless-stopped

    # Keep alive for docker compose exec workflows.
    command: ["bash", "-lc", "tail -f /dev/null"]

    # Resource limits (applied by Swarm; harmless in regular compose).
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 6G
        reservations:
          cpus: '1'
          memory: 2G
